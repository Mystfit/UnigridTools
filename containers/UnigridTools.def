BootStrap: docker
From: debian:sid

%environment
    PYTHONPATH=/tmp/Arnold/python
    export PYTHONPATH

%post -c /bin/bash
    apt-get update
    apt-get install -y git bash wget

    # Internal Singularity
    apt-get -y install singularity-container
    
    # Python
    apt-get install -y python3 python3-pip
    pip3 install setuptools
    wget -O ~/get-pip.py https://bootstrap.pypa.io/get-pip.py
    python ~/get-pip.py

    # Arnold SDK
    apt-get -y install python less libx11-6
    wget -o ~/arnold_sdk.tgz https://www.arnoldrenderer.com/dynamic_resources/product_downloads/2765/files/Arnold-5.3.0.2-linux.tgz
    tar -xf ~/arnold_sdk.tgz -C /usr/local

    # Python-OpenImageiO
    apt-get install -y python3-openimageio git

    # Unigrid tools
    if [ ! -d "./UnigridTools" ]; then 
        git clone https://github.com/mystfit/UnigridTools.git
    else
        git -C ./UnigridTools pull
    fi
    cd ./UnigridTools/python
    pip3 install .
    cd ../../

    # DEV Bind paths
    mkdir /test-project
    mkdir /UnigridTools

%runscript
    echo "Entry points in this container, run with --app"
    echo " - render_heatmaps"
    echo " - split_tiles"
    echo " - start_stitch_server"
    echo " - stitch_tiles"

%apprun render_heatmaps
    render_heatmaps -kc /usr/local/bin/kick "$@"

%apprun split
    split_tiles "$@"

%apprun start_stitch_server
    start_stitch_server "$@"

%apprun stitch
    stitch_tiles "$@"
